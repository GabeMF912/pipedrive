<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Comercial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <div style="width: 80%; margin: 0 auto;">
        <canvas id="metaComercialLinear"></canvas>
        <canvas id="metaComercialRealizado"></canvas>
    </div>

    <script>
        // Configurações da API do Google Sheets
        const SPREADSHEET_ID = '1tTwdpV7G8M7JIFLjdQihBvopMbZjW22W_WwkZRc3sZs'; // Sua ID de planilha
        const API_KEY = 'AIzaSyDXxy5eAzOaeVNojHpAHiX3l5jpSAY03Nk'; // Sua chave de API

        // Valor atual (mensalmente)
        const valorAtualMensal = [0, 0, 0, 0, 0, 0]; // Inicialmente, todos os valores são zero
        const valorLinearMensal = [0, 0, 0, 0, 0, 0]; // Inicialmente, todos os valores são zero

        // Nomes dos meses
        const meses = ['Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        
        // Inicializa a API do Google Sheets
        function init() {
            gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            }).then(() => {
                // Chame a função para obter os dados da planilha
                getDataFromGoogleSheets();
            });
        }

        // Calcula os valores da meta com base nas regras específicas
        function calculateMeta() {
            for (let i = 0; i < meses.length; i++) {
                if (i === 0) {
                    // Mês de Junho: Começa em 0
                    valorLinearMensal[i] = 0;
                } else if (i < 4) {
                    // Primeiros três meses: Aumenta gradualmente para R$ 200.000
                    valorLinearMensal[i] = (200000 / 3) * i;
                } else {
                    // Próximos três meses: Aumenta de R$ 200.000 para R$ 350.000
                    valorLinearMensal[i] = 200000 + ((350000 - 200000) / 3) * (i - 3);
                }
            }
        }

        // Obtém os dados da planilha do Google Sheets
        function getDataFromGoogleSheets() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: "C2:C7" // Ajuste a faixa para corresponder às suas células na planilha
            }).then((response) => {
                const values = response.result.values;

                // Extrair os valores de faturamento mensais da planilha
                const faturamentoMensal = values.map((row) => parseInt(row[0]));

                // Atualizar o valor atual mensal com os valores da planilha
                valorAtualMensal.forEach((_, index) => {
                    valorAtualMensal[index] = faturamentoMensal[index];
                });

                // Calcula os valores da meta com base nas regras específicas
                calculateMeta();

                // Configuração do gráfico da "Meta Linear"
                const ctxLinear = document.getElementById('metaComercialLinear').getContext('2d');
                const chartLinear = new Chart(ctxLinear, {
                    type: 'line',
                    data: {
                        labels: meses,
                        datasets: [
                            {
                                label: 'Linear de Faturamento',
                                data: valorLinearMensal,
                                borderColor: 'rgba(0, 78, 149, 1)',
                                borderWidth: 2,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Configuração do gráfico do "Faturamento Realizado"
                const ctxRealizado = document.getElementById('metaComercialRealizado').getContext('2d');
                const chartRealizado = new Chart(ctxRealizado, {
                    type: 'line',
                    data: {
                        labels: meses,
                        datasets: [
                            {
                                label: 'Faturamento Realizado',
                                data: valorAtualMensal,
                                borderColor: 'rgba(251, 170, 38, 1)',
                                borderWidth: 2,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
        }

        // Carrega a API do Google Sheets
        gapi.load('client', init);

    </script>
</body>
</html>
