<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitura de Valor Numérico e Geração de Gráfico</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        #chart-container {
            position: absolute;
            top: 20px;
            height: 300px;
            width: 600px;
            background-color: #eeeeee;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        canvas {
            background-color: transparent;
        }

        #container {
            background-color: #eeeeee;
            border-radius: 10px;
            padding: 10px;
            display: inline-block;
            position: absolute;
            top: 41px;
            left: 155px;
            transform: translateX(-50%);
            z-index: 1;
            border: 3px solid #004e95;
            font-family: "Montserrat", sans-serif;
            color: #183059;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div id="chart-container">
        <canvas id="metaComercial"></canvas>
        <div id="container"></div>
    </div>
  
    <script>
        const SPREADSHEET_ID = '1q10XJcQ0zPYSom3XSMTj9lleC_lpQ92F6Qpsrqh4eWg';
        const API_KEY = 'AIzaSyDXxy5eAzOaeVNojHpAHiX3l5jpSAY03Nk';

        const valorAtualMensal = [0, 0, 0, 0, 0, 0, 0];
        let valorLinearMensal = [0, 0, 0, 0, 0, 0, 0]; // Inicialmente, todos os valores são zero

        const meses = ['Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];

        function init() {
            gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            }).then(() => {
                getDataFromGoogleSheets();
                updateLinearValues();
            });
        }

        // Função para buscar os valores da série linear a partir da planilha
        function updateLinearValues() {
    gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: 'Planilha1!B2:B8' // Altere a faixa para corresponder às suas células
    }).then(function(response) {
        const linearValues = response.result.values;

        if (linearValues && linearValues.length > 0) {
            valorLinearMensal = linearValues.map((row) => parseFloat(row[0]));

            // Após atualizar os valores da série linear, atualize o gráfico
            updateChart();
        }
    });
}

        // Função para buscar os dados da planilha
        function getDataFromGoogleSheets() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: "C2:C8"
            }).then((response) => {
                const values = response.result.values;

                const faturamentoMensal = values.map((row) => parseFloat(row[0]));

                valorAtualMensal.forEach((_, index) => {
                    valorAtualMensal[index] = faturamentoMensal[index];
                });

                // Após buscar os valores da planilha, atualize os valores da série linear
                updateLinearValues();

                updateContainer();
            });
        }

        const ctx = document.getElementById('metaComercial').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: meses,
                datasets: [
                    {
                        label: 'Linear de Faturamento',
                        data: valorLinearMensal,
                        borderColor: 'rgba(0, 78, 149, 1)',
                        borderWidth: 5,
                        fill: true
                    },
                    {
                        label: 'Faturamento Realizado',
                        data: valorAtualMensal,
                        borderColor: 'rgba(251, 170, 38, 1)',
                        borderWidth: 5,
                        fill: true
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                    }
                }
            }
        });

        function updateChart() {
            chart.update();
        }

        function updateContainer() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: 'Planilha1!C8'
            }).then(function(response) {
                var valorDaCelula = response.result.values[0][0];
                var container = document.getElementById('container');
                container.textContent = 'R$ ' + valorDaCelula;
            });
        }

        gapi.load('client', init);

        function getDataPeriodically() {
            getDataFromGoogleSheets();
            updateLinearValues();
        }

        setInterval(getDataPeriodically, 5000);
    </script>
</body>
</html>
