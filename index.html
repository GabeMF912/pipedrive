<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Comercial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alinhar o conteúdo ao topo da página */
        }

        #chart-container {
            position: absolute;
            top: 20px; /* Espaço no topo */
            width: 1000px;
            height: 400px; /* Define um tamanho fixo para o contêiner do gráfico */
            background-color: #eeeeee);
            padding: 10px;
            border-radius: 10px;
        }

        canvas {
            background-color: transparent;
        }
    </style>
</head>
<body>
    <div id="chart-container">
        <canvas id="metaComercial"></canvas>
    </div>

    <script>
        // Configurações da API do Google Sheets
        const SPREADSHEET_ID = '1tTwdpV7G8M7JIFLjdQihBvopMbZjW22W_WwkZRc3sZs'; // Sua ID de planilha
        const API_KEY = 'AIzaSyDXxy5eAzOaeVNojHpAHiX3l5jpSAY03Nk'; // Sua chave de API

        // Valor atual (mensalmente)
        const valorAtualMensal = [0, 0, 0, 0, 0, 0, 0]; // Inicialmente, todos os valores são zero
        const valorLinearMensal = [0, 0, 0, 0, 0, 0]; // Inicialmente, todos os valores são zero

        // Nomes dos meses
        const meses = ['Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];

        // Inicializa a API do Google Sheets
        function init() {
            gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            }).then(() => {
                // Chame a função para obter os dados da planilha
                getDataFromGoogleSheets();
            });
        }

        // Calcula os valores da meta com base nas regras específicas
        function calculateMeta() {
            for (let i = 0; i < meses.length; i++) {
                if (i === 0) {
                    // Mês de Junho: Começa em 0
                    valorLinearMensal[i] = 0;
                } else if (i < 4) {
                    // Primeiros três meses: Aumenta gradualmente para R$ 200.000
                    valorLinearMensal[i] = (200000 / 3) * i;
                } else {
                    // Próximos três meses: Aumenta de R$ 200.000 para R$ 350.000
                    valorLinearMensal[i] = 200000 + ((350000 - 200000) / 3) * (i - 3);
                }
            }
        }

        // Obtém os dados da planilha do Google Sheets
        function getDataFromGoogleSheets() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: "C2:C8" // Ajuste a faixa para corresponder às suas células na planilha
            }).then((response) => {
                const values = response.result.values;

                // Extrair os valores de faturamento mensais da planilha
                const faturamentoMensal = values.map((row) => parseFloat(row[0]));

                // Atualizar o valor atual mensal com os valores da planilha
                valorAtualMensal.forEach((_, index) => {
                    valorAtualMensal[index] = faturamentoMensal[index];
                });

                // Imprime a lista valorAtualMensal no console
                console.log('Valor Atual Mensal:', valorAtualMensal);

                // Calcula os valores da meta com base nas regras específicas
                calculateMeta();

                // Configuração do gráfico
                const ctx = document.getElementById('metaComercial').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: meses,
                        datasets: [
                            {
                                label: 'Linear de Faturamento',
                                data: valorLinearMensal,
                                borderColor: 'rgba(0, 78, 149, 1)',
                                borderWidth: 5,
                                fill: true
                            },
                            {
                                label: 'Faturamento Realizado',
                                data: valorAtualMensal,
                                borderColor: 'rgba(251, 170, 38, 1)',
                                borderWidth: 5,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                            }
                        }
                    }
                });
            });
        }

        // Carrega a API do Google Sheets
        gapi.load('client', init);

    </script>
</body>
</html>
